---
- config:
  - testset: "Database API Tests"
  - api: &api "database_api"
  - variable_binds:
    - api: *api
  - generators:
    - test_id: {type: 'number_sequence', start: 1}

- base_test: &base_test
  - generator_binds:
    - test_id: test_id
  - group: *api
  - url: "/rpc"
  - method: "POST"
  - body: {template: {file: "request_template.json"}}

- validator_base: &validator_base
  - extract_test: {jsonpath_mini: "error", test: "not_exists"}
  - extract_test: {jsonpath_mini: "result", test: "exists"}
  - compare: {jsonpath_mini: "id", comparator: "str_eq", expected: {template: $test_id}}

- validator_result_json: &validator_result_json
  - json_file_validator: {jsonpath_mini: "result", comparator: "json_compare", expected: {template: '$api/$method'}}

- test:
  - name: "get_dynamic_global_properties"
  - variable_binds:
    - method: "get_dynamic_global_properties"
    - args: {}
  - <<: *base_test
  - validators:
    - <<: *validator_base
    - extract_test: {jsonpath_mini: "result.available_account_subsidies", test: "exists"}
    - extract_test: {jsonpath_mini: "result.content_reward_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.current_aslot", test: "exists"}
    - extract_test: {jsonpath_mini: "result.current_hbd_supply", test: "exists"}
    - extract_test: {jsonpath_mini: "result.current_hbd_supply.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.current_hbd_supply.nai", comparator: "str_eq", expected: "@@000000013"}
    - compare: {jsonpath_mini: "result.current_hbd_supply.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.current_supply", test: "exists"}
    - extract_test: {jsonpath_mini: "result.current_supply.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.current_supply.nai", comparator: "str_eq", expected: "@@000000021"}
    - compare: {jsonpath_mini: "result.current_supply.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.current_witness", test: "exists"}
    - extract_test: {jsonpath_mini: "result.delegation_return_period", test: "exists"}
    - extract_test: {jsonpath_mini: "result.downvote_pool_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.hbd_interest_rate", test: "exists"}
    - extract_test: {jsonpath_mini: "result.hbd_print_rate", test: "exists"}
    - extract_test: {jsonpath_mini: "result.hbd_start_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.hbd_stop_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.head_block_id", test: "exists"}
    - extract_test: {jsonpath_mini: "result.head_block_number", test: "exists"}
    - extract_test: {jsonpath_mini: "result.id", test: "exists"}
    - extract_test: {jsonpath_mini: "result.init_hbd_supply", test: "exists"}
    - extract_test: {jsonpath_mini: "result.init_hbd_supply.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.init_hbd_supply.nai", comparator: "str_eq", expected: "@@000000013"}
    - compare: {jsonpath_mini: "result.init_hbd_supply.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.last_budget_time", test: "exists"}
    - extract_test: {jsonpath_mini: "result.last_irreversible_block_num", test: "exists"}
    - extract_test: {jsonpath_mini: "result.maximum_block_size", test: "exists"}
    - extract_test: {jsonpath_mini: "result.next_maintenance_time", test: "exists"}
    - extract_test: {jsonpath_mini: "result.num_pow_witnesses", test: "exists"}
    - extract_test: {jsonpath_mini: "result.participation_count", test: "exists"}
    - extract_test: {jsonpath_mini: "result.pending_rewarded_vesting_hive", test: "exists"}
    - extract_test: {jsonpath_mini: "result.pending_rewarded_vesting_hive.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.pending_rewarded_vesting_hive.nai", comparator: "str_eq", expected: "@@000000021"}
    - compare: {jsonpath_mini: "result.pending_rewarded_vesting_hive.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.pending_rewarded_vesting_shares", test: "exists"}
    - extract_test: {jsonpath_mini: "result.pending_rewarded_vesting_shares.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.pending_rewarded_vesting_shares.nai", comparator: "str_eq", expected: "@@000000037"}
    - compare: {jsonpath_mini: "result.pending_rewarded_vesting_shares.precision", comparator: "eq", expected: 6}
    - extract_test: {jsonpath_mini: "result.recent_slots_filled", test: "exists"}
    - extract_test: {jsonpath_mini: "result.required_actions_partition_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.reverse_auction_seconds", test: "exists"}
    - extract_test: {jsonpath_mini: "result.sps_fund_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.sps_interval_ledger", test: "exists"}
    - extract_test: {jsonpath_mini: "result.sps_interval_ledger.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.sps_interval_ledger.nai", comparator: "str_eq", expected: "@@000000013"}
    - compare: {jsonpath_mini: "result.sps_interval_ledger.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.time", test: "exists"}
    - extract_test: {jsonpath_mini: "result.total_pow", test: "exists"}
    - extract_test: {jsonpath_mini: "result.total_reward_fund_hive", test: "exists"}
    - extract_test: {jsonpath_mini: "result.total_reward_fund_hive.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.total_reward_fund_hive.nai", comparator: "str_eq", expected: "@@000000021"}
    - compare: {jsonpath_mini: "result.total_reward_fund_hive.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.total_reward_shares2", test: "exists"}
    - extract_test: {jsonpath_mini: "result.total_vesting_fund_hive", test: "exists"}
    - extract_test: {jsonpath_mini: "result.total_vesting_fund_hive.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.total_vesting_fund_hive.nai", comparator: "str_eq", expected: "@@000000021"}
    - compare: {jsonpath_mini: "result.total_vesting_fund_hive.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.total_vesting_shares", test: "exists"}
    - extract_test: {jsonpath_mini: "result.total_vesting_shares.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.total_vesting_shares.nai", comparator: "str_eq", expected: "@@000000037"}
    - compare: {jsonpath_mini: "result.total_vesting_shares.precision", comparator: "eq", expected: 6}
    - extract_test: {jsonpath_mini: "result.vesting_reward_percent", test: "exists"}
    - extract_test: {jsonpath_mini: "result.virtual_supply", test: "exists"}
    - extract_test: {jsonpath_mini: "result.virtual_supply.amount", test: "exists"}
    - compare: {jsonpath_mini: "result.virtual_supply.nai", comparator: "str_eq", expected: "@@000000021"}
    - compare: {jsonpath_mini: "result.virtual_supply.precision", comparator: "eq", expected: 3}
    - extract_test: {jsonpath_mini: "result.vote_power_reserve_rate", test: "exists"}

- test:
  - name: "get_config"
  - variable_binds:
    - method: "get_config"
    - args: {}
  - <<: *base_test
  - validators:
    - <<: *validator_base
    - <<: *validator_result_json

- test:
  - name: "get_witness_schedule"
  - variable_binds:
    - method: "get_witness_schedule"
    - args: {}
  - <<: *base_test
  - validators:
    - <<: *validator_base
    - <<: *validator_result_json
    - extract_test: {jsonpath_mini: "result.account_subsidy_witness_rd.min_decay", test: "exists"}
    - extract_test: {jsonpath_mini: "result.current_shuffled_witnesses", test: "exists"}
    - extract_test: {jsonpath_mini: "result.current_virtual_time", test: "exists"}
    - extract_test: {jsonpath_mini: "result.next_shuffle_block_num", test: "exists"}

- test:
  - name: "get_hardfork_properties"
  - variable_binds:
    - method: "get_hardfork_properties"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_reward_funds"
  - variable_binds:
    - method: "get_reward_funds"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_current_price_feed"
  - variable_binds:
    - method: "get_current_price_feed"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_feed_history"
  - variable_binds:
    - method: "get_feed_history"
    - args: {}
  - <<: *base_test

- test:
  - name: "list_witnesses"
  - variable_binds:
    - method: "get_feed_history"
    - args: '{ "start": 0, "limit": 1, "order": "by_name" }'
  - <<: *base_test
