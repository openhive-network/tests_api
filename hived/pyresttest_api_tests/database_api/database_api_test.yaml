---
- config:
  - testset: "Database API Tests"
  - api: &api "database_api"
  - variable_binds:
    - api: *api
  - generators:
    - test_id: {type: 'number_sequence', start: 1}

- validator_base: &validator_base
  - compare: {jsonpath_mini: "id", comparator: "str_eq", expected: {template: $test_id}}

- validator_result_json: &validator_result_json
  - json_file_validator: {jsonpath_mini: "result", comparator: "json_compare", expected: {template: '$api/$method'}}

- validator_schema_json: &validator_schema_json
  - json_schema: {schema: {file: {template: '$method.schema.json'}}}

- validator_schema_gen: &validator_schema_gen
  - json_schema_generate: {schema_file: '$api/$method.schema.json', output_file: '$api/$method.out.json'}

- base_test: &base_test
  - generator_binds:
    - test_id: test_id
  - group: *api
  - url: "/rpc"
  - method: "POST"
  - body: {template: {file: "request_template.json"}}
  - validators:
    - <<: *validator_base
    - <<: *validator_schema_json

- test:
  - name: "get_dynamic_global_properties"
  - variable_binds:
    - method: "get_dynamic_global_properties"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_config"
  - variable_binds:
    - method: "get_config"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_version"
  - variable_binds:
    - method: "get_version"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_witness_schedule"
  - variable_binds:
    - method: "get_witness_schedule"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_hardfork_properties"
  - variable_binds:
    - method: "get_hardfork_properties"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_reward_funds"
  - variable_binds:
    - method: "get_reward_funds"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_current_price_feed"
  - variable_binds:
    - method: "get_current_price_feed"
    - args: {}
  - <<: *base_test

- test:
  - name: "get_feed_history"
  - variable_binds:
    - method: "get_feed_history"
    - args: {}
  - <<: *base_test

- test:
  - name: "list_witnesses"
  - variable_binds:
    - method: "list_witnesses"
    - args: '{ "start": 0, "limit": 1, "order": "by_name" }'
  - <<: *base_test

- test:
  - name: "find_witnesses"
  - variable_binds:
    - method: "find_witnesses"
    - args: '{ "owners": ["initminer"] }'
  - <<: *base_test

- test:
  - name: "list_witness_votes"
  - variable_binds:
    - method: "list_witness_votes"
    - args: '{ "start": ["initminer", ""], "limit": 1, "order": "by_witness_account" }'
  - <<: *base_test

- test:
  - name: "get_active_witnesses"
  - variable_binds:
    - method: "get_active_witnesses"
    - args: {}
  - <<: *base_test

- test:
  - name: "list_accounts"
  - variable_binds:
    - method: "list_accounts"
    - args: '{ "start": "", "limit": 10, "order": "by_name" }'
  - <<: *base_test

- test:
  - name: "find_accounts"
  - variable_binds:
    - method: "find_accounts"
    - args: '{ "accounts": ["initminer", "null"] }'
  - <<: *base_test

- test:
  - name: "list_owner_histories"
  - variable_binds:
    - method: "list_owner_histories"
    - args: '{ "start": ["null", "1970-01-01T00:00:00"], "limit": 1 }'
  - <<: *base_test

- test:
  - name: "find_owner_histories"
  - variable_binds:
    - method: "find_owner_histories"
    - args: '{ "owner": "null" }'
  - <<: *base_test

- test:
  - name: "list_account_recovery_requests"
  - variable_binds:
    - method: "list_account_recovery_requests"
    - args: '{ "start": "null", "limit": 1, "order": "by_account" }'
  - <<: *base_test

- test:
  - name: "find_account_recovery_requests"
  - variable_binds:
    - method: "find_account_recovery_requests"
    - args: '{ "accounts": ["null"] }'
  - <<: *base_test

- test:
  - name: "list_change_recovery_account_requests"
  - variable_binds:
    - method: "list_change_recovery_account_requests"
    - args: '{ "start": "", "limit": 2, "order": "by_account" }'
  - <<: *base_test

- test:
  - name: "find_change_recovery_account_requests"
  - variable_binds:
    - method: "find_change_recovery_account_requests"
    - args: '{ "accounts": ["null"] }'
  - <<: *base_test

- test:
  - name: "list_escrows"
  - variable_binds:
    - method: "list_escrows"
    - args: '{ "start": ["initminer", 0], "limit": 10, "order": "by_from_id" }'
  - <<: *base_test

- test:
  - name: "find_escrows"
  - variable_binds:
    - method: "find_escrows"
    - args: '{ "from": "temp" }'
  - <<: *base_test

- test:
  - name: "list_withdraw_vesting_routes"
  - variable_binds:
    - method: "list_withdraw_vesting_routes"
    - args: '{ "start": ["", ""], "limit": 10, "order": "by_withdraw_route" }'
  - <<: *base_test

- test:
  - name: "find_withdraw_vesting_routes"
  - variable_binds:
    - method: "find_withdraw_vesting_routes"
    - args: '{ "account": "null", "order": "by_destination" }'
  - <<: *base_test

- test:
  - name: "list_savings_withdrawals"
  - variable_binds:
    - method: "list_savings_withdrawals"
    - args: '{ "start": ["null", 0], "limit": 10, "order": "by_from_id" }'
  - <<: *base_test

- test:
  - name: "find_savings_withdrawals"
  - variable_binds:
    - method: "find_savings_withdrawals"
    - args: '{ "account": "voltair" }'
  - <<: *base_test

- test:
  - name: "list_vesting_delegations"
  - variable_binds:
    - method: "list_vesting_delegations"
    - args: '{ "start": ["null", "null"], "limit": 10, "order": "by_delegation" }'
  - <<: *base_test

- test:
  - name: "find_vesting_delegations"
  - variable_binds:
    - method: "find_vesting_delegations"
    - args: '{ "account": "voltair" }'
  - <<: *base_test

- test:
  - name: "list_vesting_delegation_expirations"
  - variable_binds:
    - method: "list_vesting_delegation_expirations"
    - args: '{ "start": ["1970-01-01T00:00:00", 0], "limit": 10, "order": "by_expiration" }'
  - <<: *base_test
